<div id="wwwsqldesigner">
  <div id="area"></div>

  <div id="controls">
    <div id="bar">
      <div id="toggle"></div>
      <input type="button" id="saveload" />

      <hr/>

      <input type="button" id="addtable" />
      <input type="button" id="edittable" />
      <input type="button" id="tablekeys" style="display: none" />
      <input type="button" id="removetable" />
      <input type="button" id="aligntables" style="display: none" />
      <input type="button" id="cleartables" />

      <hr/>

      <input type="button" id="addrow" />
      <input type="button" id="editrow" />
      <input type="button" id="uprow" class="small" /><input type="button" id="downrow" class="small"/>
      <input type="button" id="foreigncreate" />
      <input type="button" id="foreignconnect" />
      <input type="button" id="foreigndisconnect" />
      <input type="button" id="removerow" />

      <input type="button" id="options" style="display: none"/>
      <a href="https://github.com/ondras/wwwsqldesigner/wiki" target='_blank'><input type="button" id="docs" value=""  style="display: none"/></a>
    </div>

    <div id="rubberband"></div>

    <div id="minimap"></div>

    <div id="background"></div>

    <div id="window">
      <div id="windowtitle">
        <%= image_tag "wwwsqldesigner/images/throbber.gif", id: 'throbber' %>
        <!-- <img id="throbber" src="images/throbber.gif" alt="" title=""/> -->
      </div>
      <div id="windowcontent"></div>
      <input type="button" id="windowok" />
      <input type="button" id="windowcancel" />
    </div>
  </div> <!-- #controls -->

  <div id="opts">
    <table>
      <tbody>
        <tr>
          <td>
            * <label id="language" for="optionlocale"></label>
          </td>
          <td>
            <select id="optionlocale"><option></option></select>
          </td>
        </tr>
        <tr>
          <td>
            * <label id="db" for="optiondb"></label>
          </td>
          <td>
            <select id="optiondb"><option></option></select>
          </td>
        </tr>
        <tr>
          <td>
            <label id="snap" for="optionsnap"></label>
          </td>
          <td>
            <input type="text" size="4" id="optionsnap" />
            <span class="small" id="optionsnapnotice"></span>
          </td>
        </tr>
        <tr>
          <td>
            <label id="pattern" for="optionpattern"></label>
          </td>
          <td>
            <input type="text" size="6" id="optionpattern" />
            <span class="small" id="optionpatternnotice"></span>
          </td>
        </tr>
        <tr>
          <td>
            <label id="hide" for="optionhide"></label>
          </td>
          <td>
            <input type="checkbox" id="optionhide" />
          </td>
        </tr>
        <tr>
          <td>
            * <label id="vector" for="optionvector"></label>
          </td>
          <td>
            <input type="checkbox" id="optionvector" />
          </td>
        </tr>
        <tr>
          <td>
            * <label id="showsize" for="optionshowsize"></label>
          </td>
          <td>
            <input type="checkbox" id="optionshowsize" />
          </td>
        </tr>
        <tr>
          <td>
            * <label id="showtype" for="optionshowtype"></label>
          </td>
          <td>
            <input type="checkbox" id="optionshowtype" />
          </td>
        </tr>
      </tbody>
    </table>

    <hr />

    * <span class="small" id="optionsnotice"></span>
  </div>

  <div id="io">
    <table>
      <tbody>
        <tr>
          <td style="width:60%">
            <fieldset>
              <legend id="client"></legend>
              <div id="singlerow">
              <input type="button" id="clientsave" />
              <input type="button" id="clientload" />
              </div>
              <div id="singlerow"  style="display: none">
              <input type="button" id="clientlocalsave" style="display: none" />
              <input type="button" id="clientlocalload" style="display: none" />
              <input type="button" id="clientlocallist" style="display: none" />
              </div>
              <div id="singlerow" style="display: none">
                <input type="button" id="dropboxsave" /><!-- may get hidden by dropBoxInit() -->
                <input type="button" id="dropboxload" /><!-- may get hidden by dropBoxInit() -->
                <input type="button" id="dropboxlist" /><!-- may get hidden by dropBoxInit() -->
              </div>
              <input type="button" id="clientsql" style="display: none" />
            </fieldset>
          </td>
          <td style="width:40%">
            <fieldset>
              <legend id="server"></legend>
              <label style="display: none" for="backend" id="backendlabel"></label>
              <select id="backend" style="display: none"><option></option></select>
              <input type="button" id="serversave"  style="display: none" />
              <input type="button" id="quicksave" />
              <input type="button" id="serverload"  style="display: none"/>
              <input type="button" id="serverlist" style="display: none" />
              <input type="button" id="serverimport" style="display: none" />
            </fieldset>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <fieldset>
              <legend id="output"></legend>
              <textarea id="textarea" rows="1" cols="1"></textarea><!--modified by javascript later-->
            </fieldset>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div id="keys">
    <fieldset>
      <legend id="keyslistlabel"></legend>
      <select id="keyslist"><option></option></select>
      <input type="button" id="keyadd" />
      <input type="button" id="keyremove" />
    </fieldset>
    <fieldset>
      <legend id="keyedit"></legend>
      <table>
        <tbody>
          <tr>
            <td>
              <label for="keytype" id="keytypelabel"></label>
              <select id="keytype"><option></option></select>
            </td>
            <td></td>
            <td>
              <label for="keyname" id="keynamelabel"></label>
              <input type="text" id="keyname" size="10" />
            </td>
          </tr>
          <tr>
            <td colspan="3"><hr/></td>
          </tr>
          <tr>
            <td>
              <label for="keyfields" id="keyfieldslabel"></label><br/>
              <select id="keyfields" size="5" multiple="multiple"><option></option></select>
            </td>
            <td>
              <input type="button" id="keyleft" value="&lt;&lt;" /><br/>
              <input type="button" id="keyright" value="&gt;&gt;" /><br/>
            </td>
            <td>
              <label for="keyavail" id="keyavaillabel"></label><br/>
              <select id="keyavail" size="5" multiple="multiple"><option></option></select>
            </td>
          </tr>
        </tbody>
      </table>
    </fieldset>
  </div>

  <div id="table">
    <table>
      <tbody>
        <tr>
          <td>
            <label id="tablenamelabel" for="tablename"></label>
          </td>
          <td>
            <input id="tablename" type="text" />
          </td>
        </tr>
        <tr>
          <td>
            <label id="tablecommentlabel" for="tablecomment"></label>
          </td>
          <td>
            <textarea rows="5" cols="40" id="tablecomment"></textarea>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="row">
    <div class="col">
      <%= link_to "Edit DB Schema", edit_db_schema_path(@db_schema) %>
    </div>
  </div>
</div>

<%= content_for :after_js do %>
  <script type="text/javascript">
    var designer = new SQL.Designer();
    designer.languageResponse((new DOMParser()).parseFromString(
      '<%= j raw File.read(Rails.root.join("app/assets/javascripts/wwwsqldesigner/locale/en.xml")) %>',
      'text/xml'));
    designer.dbResponse((new DOMParser()).parseFromString(
      '<%= j raw File.read(Rails.root.join("app/assets/javascripts/wwwsqldesigner/db/postgresql/datatypes.xml")) %>',
      'text/xml'));

    // designer.setSaveUrl('<%#= database_schema_path(@database_schema, authenticity_token: form_authenticity_token) %>');
    designer.io.loadresponse((new DOMParser()).parseFromString(
      '<%= j raw @db_schema.content %>', 'text/xml'), 200);
  </script>
<% end %>
